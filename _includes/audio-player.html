
<script>!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).SoundCloudAudio=t()}}(function(){return function t(e,i,n){function o(r,a){if(!i[r]){if(!e[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(s)return s(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var d=i[r]={exports:{}};e[r][0].call(d.exports,function(t){var i=e[r][1][t];return o(i||t)},d,d.exports,t,e,i,n)}return i[r].exports}for(var s="function"==typeof require&&require,r=0;r<n.length;r++)o(n[r]);return o}({1:[function(t,e,i){"use strict";var n,o="protocol hostname host pathname port search hash href".split(" ");function s(t){n||(n=document.createElement("a"));var e={};n.href=t||"";for(var i=0,s=o.length;i<s;i++){var r=o[i];e[r]=n[r]}return e}function r(t,e,i){var n=s(t),o=/\?(?:.*)$/.test(n.search)?"&":"?";return n.protocol+"//"+n.host+n.port+n.pathname+n.search+o+e+"="+i+n.hash}function a(t){if(!(this instanceof a))return new a(t);t||console.info("SoundCloud API requires clientId, get it at https://developers.soundcloud.com"),this._events={},this._clientId=t,this._baseUrl="https://api.soundcloud.com",this.playing=!1,this.duration=0,this.audio=document.createElement("audio")}a.prototype.resolve=function(t,e){var i=this._baseUrl+"/resolve.json?url="+encodeURIComponent(t)+"&client_id="+this._clientId;this._json(i,function(i){if(this.cleanData(),Array.isArray(i))i={tracks:i},this._playlist=i;else if(i.tracks)this._playlist=i;else{this._track=i;var n=s(t);this._track.stream_url+=n.hash}this.duration=i.duration&&!isNaN(i.duration)?i.duration/1e3:0,e(i)}.bind(this))},a.prototype._jsonp=function(t,e){var i=document.getElementsByTagName("script")[0]||document.head,n=document.createElement("script"),o="jsonp_callback_"+(new Date).valueOf()+Math.floor(1e3*Math.random());window[o]=function(t){n.parentNode&&n.parentNode.removeChild(n),window[o]=function(){},e(t)},n.src=r(t,"callback",o),i.parentNode.insertBefore(n,i)},a.prototype._json=function(t,e){var i=new XMLHttpRequest;i.open("GET",t),i.onreadystatechange=function(){if(4===i.readyState&&200===i.status){var t={};try{t=JSON.parse(i.responseText)}catch(t){}e(t)}},i.send(null)},a.prototype.on=function(t,e){this._events[t]=e,this.audio.addEventListener(t,e,!1)},a.prototype.off=function(t,e){this._events[t]=null,this.audio.removeEventListener(t,e)},a.prototype.unbindAll=function(){for(var t in this._events){var e=this._events[t];e&&this.off(t,e)}},a.prototype.preload=function(t,e){this._track={stream_url:t},e&&(this.audio.preload=e),this.audio.src=this._clientId?r(t,"client_id",this._clientId):t},a.prototype.play=function(t){var e;if((t=t||{}).streamUrl)e=t.streamUrl;else if(this._playlist){var i=this._playlist.tracks.length;if(i){if(void 0===t.playlistIndex?this._playlistIndex=this._playlistIndex||0:this._playlistIndex=t.playlistIndex,this._playlistIndex>=i||this._playlistIndex<0)return void(this._playlistIndex=0);e=this._playlist.tracks[this._playlistIndex].stream_url}}else this._track&&(e=this._track.stream_url);if(!e)throw new Error("There is no tracks to play, use `streamUrl` option or `load` method");return this._clientId&&(e=r(e,"client_id",this._clientId)),e!==this.audio.src&&(this.audio.src=e),this.playing=e,this.audio.play()},a.prototype.pause=function(){this.audio.pause(),this.playing=!1},a.prototype.stop=function(){this.audio.pause(),this.audio.currentTime=0,this.playing=!1},a.prototype.next=function(t){t=t||{};var e=this._playlist.tracks.length;if(this._playlistIndex>=e-1){if(!t.loop)return;this._playlistIndex=-1}if(this._playlist&&e)return this.play({playlistIndex:++this._playlistIndex})},a.prototype.previous=function(){if(!(this._playlistIndex<=0))return this._playlist&&this._playlist.tracks.length?this.play({playlistIndex:--this._playlistIndex}):void 0},a.prototype.seek=function(t){if(!this.audio.readyState)return!1;var e=t.offsetX/t.target.offsetWidth||(t.layerX-t.target.offsetLeft)/t.target.offsetWidth;this.audio.currentTime=e*(this.audio.duration||0)},a.prototype.cleanData=function(){this._track=void 0,this._playlist=void 0},a.prototype.setVolume=function(t){this.audio.readyState&&(this.audio.volume=t)},a.prototype.setTime=function(t){this.audio.readyState&&(this.audio.currentTime=t)},e.exports=a},{}]},{},[1])(1)});
</script>

<div class="player">
  <span><i class="audio-control icon-play" data-url="{{page.soundcloud_url}}"></i></span>
  <span class="status" data-url="{{page.soundcloud_url}}">LISTEN</span>
  <span class="Rectangle-4"><i class="progress"></i></span>
  <span class="length"></span>
  <span><i class="icon-menu"></i></span>
<!-- <script src="https://connect.soundcloud.com/sdk/sdk-3.3.0.js"></script> -->


<script>





  let scPlayer

  const init = (URL, lengthDisplay) => {
    scPlayer = new SoundCloudAudio(`{{site.soundcloud_client_id}}`)
    scPlayer.resolve(URL, function(track) {
      let minutes = millisToMinutesAndSeconds(track.duration)
      lengthDisplay.textContent = minutes
    })
  }



  const millisToMinutesAndSeconds = millis => {
    const minutes = Math.floor(millis / 60000)
    const seconds = ((millis % 60000) / 1000).toFixed(0)
    return minutes + ':' + (seconds < 10 ? '0' : '') + seconds
  }

  const progressBar = progressDisplay => {
    if (scPlayer.isPlaying()) {
      let progress =
        (scPlayer.currentTime() / scPlayer.getDuration()) * 100
      console.log(progress)
      progressDisplay.style.width = `${progress}%`
    }
  }

  const setCurrent = (progressDisplay) => {

        scPlayer.play()
        progressBar(progressDisplay)

  }

  document.querySelectorAll('.player').forEach(player => {
    let URL = player.getElementsByClassName('audio-control')[0].dataset.url
    let lengthDisplay = player.getElementsByClassName('length')[0]
    let progressDisplay = player.getElementsByClassName('progress')[0]

    player.querySelectorAll('.audio-control, .status').forEach(element => {
      element.addEventListener('click', () => {
        let control = document.querySelector('.audio-control')
        control.classList.toggle('icon-pause')
        control.classList.toggle('icon-play')

        let status = document.querySelector('.status')
        status.textContent === 'LISTEN'
          ? (status.textContent = 'PLAYING')
          : (status.textContent = 'LISTEN')
        if (scPlayer && scPlayer.playing()) {
          scPlayer.pause()
        } else if (scPlayer && !scPlayer.playing()) {
          scPlayer.play()
          progressBar(progressDisplay)
        } else {
          setCurrent(progressDisplay)
        }
      })
    })
    init(URL, lengthDisplay)
  })




// let currentPlayer
//
// const init = (URL, lengthDisplay) => {
//   console.log(URL)
//   SC.initialize({
//     client_id: `{{site.soundcloud_client_id}}`
//   })
//
//   SC.resolve(URL).then(json => {
//     let minutes = millisToMinutesAndSeconds(json.duration)
//     lengthDisplay.textContent = minutes
//   })
// }
//
// const millisToMinutesAndSeconds = millis => {
//   const minutes = Math.floor(millis / 60000)
//   const seconds = ((millis % 60000) / 1000).toFixed(0)
//   return minutes + ':' + (seconds < 10 ? '0' : '') + seconds
// }
//
// const progressBar = progressDisplay => {
//   if (currentPlayer.isPlaying()) {
//     let progress =
//       (currentPlayer.currentTime() / currentPlayer.getDuration()) * 100
//     console.log(progress)
//     progressDisplay.style.width = `${progress}%`
//   }
// }
//
// const setCurrent = (URL, lengthDisplay, progressDisplay) => {
//   SC.initialize({
//     client_id: `{{site.soundcloud_client_id}}`
//   })
//
//   SC.resolve(URL).then(json => {
//     let trackPath = `tracks/${json.id}`
//     SC.stream(trackPath).then(player => {
//       currentPlayer = player
//       player.play()
//       progressBar(progressDisplay)
//     })
//   })
// }
//
// document.querySelectorAll('.player').forEach(player => {
//   let URL = player.getElementsByClassName('audio-control')[0].dataset.url
//   let lengthDisplay = player.getElementsByClassName('length')[0]
//   let progressDisplay = player.getElementsByClassName('progress')[0]
//
//   player.querySelectorAll('.audio-control, .status').forEach(element => {
//     element.addEventListener('click', () => {
//       let control = document.querySelector('.audio-control')
//       control.classList.toggle('icon-pause')
//       control.classList.toggle('icon-play')
//
//       let status = document.querySelector('.status')
//       status.textContent === 'LISTEN'
//         ? (status.textContent = 'PLAYING')
//         : (status.textContent = 'LISTEN')
//
//       if (currentPlayer && currentPlayer.isPlaying()) {
//         currentPlayer.pause()
//       } else if (currentPlayer && !currentPlayer.isPlaying()) {
//         currentPlayer.play()
//         progressBar(progressDisplay)
//       } else {
//         setCurrent(URL, lengthDisplay, progressDisplay)
//       }
//     })
//   })
//   init(URL, lengthDisplay, progressDisplay)
// })
</script>

<style>
.player > span{
  display: inline-block
 }
.status{
  width: 53px;
  height: 27px;
  font-family: Inconsolata;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  font-stretch: normal;
  line-height: normal;
  letter-spacing: 1.3px;
  color: #000000;
  color: var(--black);
  margin:0 30px 0 10px;
  cursor: pointer;
 }
 .Rectangle-4 {
  width: 501px;
  height: 4px;
  position:relative;
  background-color: #b3b3b3;
}

.Rectangle-4 i.progress {
 width: 501px;
 height: 4px;
 position:absolute;
 background-color: black;
}


 .length{
   margin:0 0 0 20px
  }
.player i {
  cursor: pointer;
 }
</style>

</div>
